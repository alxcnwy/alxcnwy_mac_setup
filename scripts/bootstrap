#!/usr/bin/env bash
set -e

proj_root="$(pwd)"
timestamp="$(date +"%Y%m%d_%H%M%S")"
log_dir="$proj_root/_runs/$timestamp"

mkdir -p "$log_dir"

# venv
if [ -d ".venv" ]; then
  echo ".venv already exists."
  read -r -p "Recreate virtualenv in .venv? [y/N] " answer
  case "$answer" in
    [Yy]*)
      echo "Recreating .venv..."
      rm -rf .venv
      python3 -m venv .venv
      ;;
    *)
      echo "Reusing existing .venv"
      ;;
  esac
else
  python3 -m venv .venv
fi
source .venv/bin/activate

# deps
pip install --upgrade pip wheel
pip install flask

# agents.md
cat > "$proj_root/agents.md" <<'EOF'
# Agents

You prefer:
- Python
- Flask
- Simple, modular JavaScript
- No frameworks unless unavoidable
- Fast iteration
- Small focused files
- Reasonable assumptions
- Reviews always overwrite review.md
EOF

# log
cat > "$log_dir/init.txt" <<EOF
# ðŸ Bootstrap Run

- Timestamp: $timestamp
- Directory: $proj_root
- Python: $(python3 --version)

---

## Next Steps

- Activate the venv: \`source .venv/bin/activate\`
- Create or update \`spec.md\` with a short project brief
- Review \`agents.md\` and tweak preferences if needed
- Start your app (e.g. create \`app.py\` and run \`flask run\`)
EOF

echo "ðŸ Bootstrap complete."
echo "  Log written to: $log_dir/init.txt"
echo "  Next: edit spec.md, review agents.md, start coding."
